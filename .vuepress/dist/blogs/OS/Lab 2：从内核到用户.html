<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.14">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/logo.png"><title>Lab 2：从内核到用户 | byml's blog</title><meta name="description" content="byml's blog">
    <link rel="preload" href="/assets/style-NmqtuK-L.css" as="style"><link rel="stylesheet" href="/assets/style-NmqtuK-L.css">
    <link rel="modulepreload" href="/assets/app-CqvpY_gu.js"><link rel="modulepreload" href="/assets/Lab 2：从内核到用户.html-otQ5uXGE.js">
    <link rel="prefetch" href="/assets/timeline.html-gun0xohR.js" as="script"><link rel="prefetch" href="/assets/posts.html-DIRnngPE.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-fJlRnGdL.js" as="script"><link rel="prefetch" href="/assets/friendship.html-QfbnSaQO.js" as="script"><link rel="prefetch" href="/assets/about.html-CPZhOJnf.js" as="script"><link rel="prefetch" href="/assets/full-about.html-CdNzG-fy.js" as="script"><link rel="prefetch" href="/assets/1.html-C9NqB2ZD.js" as="script"><link rel="prefetch" href="/assets/1.html-mc34TXFd.js" as="script"><link rel="prefetch" href="/assets/1.html-Dqwdsv01.js" as="script"><link rel="prefetch" href="/assets/1.html-BXAumysi.js" as="script"><link rel="prefetch" href="/assets/1.html-Cmzr5Yeo.js" as="script"><link rel="prefetch" href="/assets/1.html-De_IYiYe.js" as="script"><link rel="prefetch" href="/assets/1.html-BnoUnyey.js" as="script"><link rel="prefetch" href="/assets/1.html-mn926g3r.js" as="script"><link rel="prefetch" href="/assets/1.html-DhOSAWqT.js" as="script"><link rel="prefetch" href="/assets/2.html-DM55X3gj.js" as="script"><link rel="prefetch" href="/assets/3.html-C6stLVpO.js" as="script"><link rel="prefetch" href="/assets/index.html-B4SdQXHf.js" as="script"><link rel="prefetch" href="/assets/Lecture 1 - Introduction.html-D4Sdg9vx.js" as="script"><link rel="prefetch" href="/assets/Lecture 2 - Classification.html-Bi4VZVnK.js" as="script"><link rel="prefetch" href="/assets/Lecture 3 - Loss Function and Optmizatoin.html-BDntLIR8.js" as="script"><link rel="prefetch" href="/assets/Lecture 4 - Backpropagation and Neural Networks.html-D8FRwtWB.js" as="script"><link rel="prefetch" href="/assets/Lecture 5 - Convolutional Neural Network.html-_pfPPJcE.js" as="script"><link rel="prefetch" href="/assets/Lecture 6 - Training Neural Networks.html-x_gyvK5M.js" as="script"><link rel="prefetch" href="/assets/Lecture 7 - Training Neural Networks.html-BcWrTBfQ.js" as="script"><link rel="prefetch" href="/assets/NumPy 学习.html-U5Hl4hH5.js" as="script"><link rel="prefetch" href="/assets/Rasterization.html-mGdU_U5C.js" as="script"><link rel="prefetch" href="/assets/Transform.html-DykOigC5.js" as="script"><link rel="prefetch" href="/assets/GDB 调试 _ VSCode 调试.html-F-Td0I10.js" as="script"><link rel="prefetch" href="/assets/Lab 1：PC，启动.html-CTVJBTwx.js" as="script"><link rel="prefetch" href="/assets/Lab 3：进程调度.html-CGoFi_1q.js" as="script"><link rel="prefetch" href="/assets/Lab 4：并发控制.html-CmRf5XQa.js" as="script"><link rel="prefetch" href="/assets/Lab 5：文件系统.html-CYXazOcK.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-DyBYsbFo.js" as="script"><link rel="prefetch" href="/assets/Ubuntu 24.04.html-DH6zdRZs.js" as="script"><link rel="prefetch" href="/assets/Vim.html-CD7MefxH.js" as="script"><link rel="prefetch" href="/assets/网站折腾实录.html-DeE--kWA.js" as="script"><link rel="prefetch" href="/assets/数字系统设计基础.html-YA9Oe03N.js" as="script"><link rel="prefetch" href="/assets/第 2 章 数字逻辑基础.html-Cka2I4-t.js" as="script"><link rel="prefetch" href="/assets/第 3 章 组合逻辑电路.html-DNkDHkdi.js" as="script"><link rel="prefetch" href="/assets/第 4 章 时序逻辑电路.html-ClqIKuuS.js" as="script"><link rel="prefetch" href="/assets/第 5 章 可编程逻辑器件.html-BcA7rtwU.js" as="script"><link rel="prefetch" href="/assets/第 6 章 运算方法和运算部件.html-1kdxuKp4.js" as="script"><link rel="prefetch" href="/assets/第 7 章 指令系统.html-D-VanV3F.js" as="script"><link rel="prefetch" href="/assets/第 8 章 中央处理器.html-CgREaU3E.js" as="script"><link rel="prefetch" href="/assets/404.html-CIDEjtqJ.js" as="script"><link rel="prefetch" href="/assets/Valine.min-Cg9XxMv-.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-CKTvSCx2.js" as="script"><link rel="prefetch" href="/assets/AboutLayout-uVGTEl2o.js" as="script"><link rel="prefetch" href="/assets/FriendshipLayout-CdBRUoaJ.js" as="script"><link rel="prefetch" href="/assets/FullAboutLayout-B3hJmILm.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-3rwgX-uT.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/logo.png" alt="byml&#39;s blog"><a href="/" class="site-name can-hide">byml&#39;s blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="课程笔记"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M19 10h7v2h-7z" fill="currentColor"></path><path d="M19 15h7v2h-7z" fill="currentColor"></path><path d="M19 20h7v2h-7z" fill="currentColor"></path><path d="M28 5H4a2.002 2.002 0 0 0-2 2v18a2.002 2.002 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2V7a2.002 2.002 0 0 0-2-2zM4 7h11v18H4zm13 18V7h11l.002 18z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->课程笔记<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="课程笔记"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M19 10h7v2h-7z" fill="currentColor"></path><path d="M19 15h7v2h-7z" fill="currentColor"></path><path d="M19 20h7v2h-7z" fill="currentColor"></path><path d="M28 5H4a2.002 2.002 0 0 0-2 2v18a2.002 2.002 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2V7a2.002 2.002 0 0 0-2-2zM4 7h11v18H4zm13 18V7h11l.002 18z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->课程笔记<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/categories/数字系统设计基础/1.html" class="link" aria-label="数字系统设计基础"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->数字系统设计基础<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/categories/CV/1.html" class="link" aria-label="CV"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->CV<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/categories/OS/1.html" class="link" aria-label="OS"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->OS<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="技术博客"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M4 24h10v2H4z" fill="currentColor"></path><path d="M4 18h10v2H4z" fill="currentColor"></path><path d="M26 14H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zM6 6v6h20V6z" fill="currentColor"></path><path d="M26 28h-6a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zm-6-8v6h6v-6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术博客<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="技术博客"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M4 24h10v2H4z" fill="currentColor"></path><path d="M4 18h10v2H4z" fill="currentColor"></path><path d="M26 14H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zM6 6v6h20V6z" fill="currentColor"></path><path d="M26 28h-6a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zm-6-8v6h6v-6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术博客<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/categories/Linux/1.html" class="link" aria-label="Linux 学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Linux 学习<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a href="/friendship.html" class="link" aria-label="友情链接"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M29.25 6.76a6 6 0 0 0-8.5 0l1.42 1.42a4 4 0 1 1 5.67 5.67l-8 8a4 4 0 1 1-5.67-5.66l1.41-1.42l-1.41-1.42l-1.42 1.42a6 6 0 0 0 0 8.5A6 6 0 0 0 17 25a6 6 0 0 0 4.27-1.76l8-8a6 6 0 0 0-.02-8.48z" fill="currentColor"></path><path d="M4.19 24.82a4 4 0 0 1 0-5.67l8-8a4 4 0 0 1 5.67 0A3.94 3.94 0 0 1 19 14a4 4 0 0 1-1.17 2.85L15.71 19l1.42 1.42l2.12-2.12a6 6 0 0 0-8.51-8.51l-8 8a6 6 0 0 0 0 8.51A6 6 0 0 0 7 28a6.07 6.07 0 0 0 4.28-1.76l-1.42-1.42a4 4 0 0 1-5.67 0z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->友情链接<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/about.html" class="link" aria-label="个人简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 8a5 5 0 1 0 5 5a5 5 0 0 0-5-5zm0 8a3 3 0 1 1 3-3a3.003 3.003 0 0 1-3 3z" fill="currentColor"></path><path d="M16 2a14 14 0 1 0 14 14A14.016 14.016 0 0 0 16 2zm-6 24.377V25a3.003 3.003 0 0 1 3-3h6a3.003 3.003 0 0 1 3 3v1.377a11.899 11.899 0 0 1-12 0zm13.992-1.451A5.002 5.002 0 0 0 19 20h-6a5.002 5.002 0 0 0-4.992 4.926a12 12 0 1 1 15.985 0z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->个人简介<!--]--></span></span><!--[--><!--]--></a></div><!--]--></nav><span class="xicon-container btn-toggle-dark-mode btn--dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><div class="mobile-menus-container"><nav class="navbar-links mobile"><!--[--><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="课程笔记"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M19 10h7v2h-7z" fill="currentColor"></path><path d="M19 15h7v2h-7z" fill="currentColor"></path><path d="M19 20h7v2h-7z" fill="currentColor"></path><path d="M28 5H4a2.002 2.002 0 0 0-2 2v18a2.002 2.002 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2V7a2.002 2.002 0 0 0-2-2zM4 7h11v18H4zm13 18V7h11l.002 18z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->课程笔记<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="课程笔记"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M19 10h7v2h-7z" fill="currentColor"></path><path d="M19 15h7v2h-7z" fill="currentColor"></path><path d="M19 20h7v2h-7z" fill="currentColor"></path><path d="M28 5H4a2.002 2.002 0 0 0-2 2v18a2.002 2.002 0 0 0 2 2h24a2.003 2.003 0 0 0 2-2V7a2.002 2.002 0 0 0-2-2zM4 7h11v18H4zm13 18V7h11l.002 18z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->课程笔记<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/categories/数字系统设计基础/1.html" class="link" aria-label="数字系统设计基础"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->数字系统设计基础<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/categories/CV/1.html" class="link" aria-label="CV"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->CV<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/categories/OS/1.html" class="link" aria-label="OS"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->OS<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="技术博客"><span class="xicon-container left title"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M4 24h10v2H4z" fill="currentColor"></path><path d="M4 18h10v2H4z" fill="currentColor"></path><path d="M26 14H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zM6 6v6h20V6z" fill="currentColor"></path><path d="M26 28h-6a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zm-6-8v6h6v-6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术博客<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="技术博客"><span class="title"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M4 24h10v2H4z" fill="currentColor"></path><path d="M4 18h10v2H4z" fill="currentColor"></path><path d="M26 14H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zM6 6v6h20V6z" fill="currentColor"></path><path d="M26 28h-6a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zm-6-8v6h6v-6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->技术博客<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/categories/Linux/1.html" class="link" aria-label="Linux 学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Linux 学习<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a href="/friendship.html" class="link" aria-label="友情链接"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M29.25 6.76a6 6 0 0 0-8.5 0l1.42 1.42a4 4 0 1 1 5.67 5.67l-8 8a4 4 0 1 1-5.67-5.66l1.41-1.42l-1.41-1.42l-1.42 1.42a6 6 0 0 0 0 8.5A6 6 0 0 0 17 25a6 6 0 0 0 4.27-1.76l8-8a6 6 0 0 0-.02-8.48z" fill="currentColor"></path><path d="M4.19 24.82a4 4 0 0 1 0-5.67l8-8a4 4 0 0 1 5.67 0A3.94 3.94 0 0 1 19 14a4 4 0 0 1-1.17 2.85L15.71 19l1.42 1.42l2.12-2.12a6 6 0 0 0-8.51-8.51l-8 8a6 6 0 0 0 0 8.51A6 6 0 0 0 7 28a6.07 6.07 0 0 0 4.28-1.76l-1.42-1.42a4 4 0 0 1-5.67 0z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->友情链接<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/about.html" class="link" aria-label="个人简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 8a5 5 0 1 0 5 5a5 5 0 0 0-5-5zm0 8a3 3 0 1 1 3-3a3.003 3.003 0 0 1-3 3z" fill="currentColor"></path><path d="M16 2a14 14 0 1 0 14 14A14.016 14.016 0 0 0 16 2zm-6 24.377V25a3.003 3.003 0 0 1 3-3h6a3.003 3.003 0 0 1 3 3v1.377a11.899 11.899 0 0 1-12 0zm13.992-1.451A5.002 5.002 0 0 0 19 20h-6a5.002 5.002 0 0 0-4.992 4.926a12 12 0 1 1 15.985 0z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->个人简介<!--]--></span></span><!--[--><!--]--></a></div><!--]--></nav><div class="appearance"><span>Appearance</span><span class="xicon-container btn-toggle-dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span></div></div><!----><!--[--><main class="page-container"><aside class="series-container"><!--[--><!--]--></aside><div class="page-content"><h1 class="page-title">Lab 2：从内核到用户</h1><div class="page-info" data-v-8f93817e><span class="xicon-container left" data-v-8f93817e><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->byml<!--]--></span></span><span class="xicon-container left" data-v-8f93817e><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->2025-03-25<!--]--></span></span><span class="xicon-container left" data-v-8f93817e><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[--><!--[--><a href="/categories/OS/1.html" class="page-info-link" data-v-8f93817e>OS</a><!--]--><!--]--></span></span><!----><!----></div><div class="theme-reco-md-content"><div><h2 id="lab-2-从内核到用户" tabindex="-1"><a class="header-anchor" href="#lab-2-从内核到用户"><span>Lab 2：从内核到用户</span></a></h2><h3 id="系统接手" tabindex="-1"><a class="header-anchor" href="#系统接手"><span>系统接手</span></a></h3><p>当 Bootloader 将操作系统的代码加载到内存以后，就将系统运行的接力棒交到了操作系统手中。操作系统内核会进行一系列初始化，然后开始执行各种用户程序。初始化的流程包括：</p><ul><li>初始化中断向量表（DIT）：接手各类中断事件的处理</li><li>初始化外部中断控制器（8259A）：设置外部中断的开关和中断号</li><li>初始化全局描述符表（GDT）：调整段选择子，写入任务状态段（TSS）和用户相关段的段选择子，并同时设定任务段寄存器（TR）</li><li>初始化设备和驱动：初始化显示设备、键盘驱动等 然后，操作系统内核就可以加载用户程序，并通过从内核态退回用户态的 <code>iret</code> 指令跳转到用户程序的入口。 上述操作服务于两条清晰而紧密相连的主线，即：</li></ul><ol><li>特权级跳转：内核态和用户态之间的跳转</li><li>中断：硬件、内核和用户程序之间的通信</li></ol><h3 id="特权级跳转" tabindex="-1"><a class="header-anchor" href="#特权级跳转"><span>特权级跳转</span></a></h3><p>󱜸 特权级跳转是如何发生的？</p><ul><li>从用户态到内核态的跳转，通过（主动）系统调用和（被动）外部硬件（例如计时器）两类中断。</li><li>从内核态跳转至用户态，是通过 <code>iret</code> 指令。</li></ul><p>󱜸 如何跳转到正确的位置？ 从低特权级到高特权级：</p><ul><li>i386 规定了存储任务状态信息的数据结构（任务状态段 TSS），可使用任务状态段寄存器 TR 来指定其地址。TSS 只用于低特权级向高特权级的跳转，特权级跳转时，CPU 会自动处理 TSS。</li><li>在 TSS 中，存储了一些寄存器（用于硬件上下文切换，在现代系统中使用的较少），还有三个堆栈，每个里面有 <code>SS</code> 和 <code>ESP</code> 两个寄存器，分别存储对应特权级的栈段选择子和栈指针，用以定位。</li><li>进入高特权级后，低特权级的内容会被压入高特权级的栈空间。 从高特权级到低特权级：</li><li>从栈空间中恢复低特权级的栈指针。</li><li>使用 <code>iret</code> 指令，由 CPU 加载 TSS 中的数据进行跳转。</li></ul><div class="callout" data-callout="example"><div class="callout-title"><div class="callout-title-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg></div><div class="callout-title-inner">以某次中断为例（ring3 → ring0 → ring3）</div></div><div class="callout-content"><p></p><ol><li>位于 ring3 的用户程序发起系统调用中断 <code>int 0x80</code>，中断参数存储于寄存器中</li><li>CPU 将有关的寄存器写入 TSS 的表区，并从 TSS 栈区取出 <code>SS0</code> 和 <code>ESP0</code> 赋值给对应寄存器</li><li>赋值完成后，在新的堆栈将表区的 EFLAGS、CS、EIP 压入栈（即 ring3 的这几个寄存器的值会存放于 ring0 堆栈栈顶）</li><li>根据 IDT，跳转执行中断处理函数，直到遇到 <code>iret</code> 指令</li><li>从 ring0 堆栈栈顶取出寄存器值并赋值，跳转回 ring3 继续执行用户程序</li></ol></div></div><div class="callout" data-callout="note"><div class="callout-title"><div class="callout-title-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path><path d="m15 5 4 4"></path></svg></div><div class="callout-title-inner">TSS 的堆栈</div></div><div class="callout-content"><p>TSS 的堆栈是静态的，即 <code>SS0/1/2</code> 和 <code>ESP0/1/2</code> 是固定不变的，也就是说，每次从低特权级跳转到高特权级，都等于进入了一个新的函数，拥有独立的堆栈。 由于 TSS 只需要在低特权级向高特权级跳转时找到 <code>SS0/1/2</code> 和 <code>ESP0/1/2</code> 的位置，ring3 的栈段选择子和栈指针没有静态存储在 TSS 中的必要。因此虽然 i386 有四个特权级，TSS 堆栈却只有三组存储 <code>SS</code> 和 <code>ESP</code> 的位置。</p></div></div><h3 id="中断通信" tabindex="-1"><a class="header-anchor" href="#中断通信"><span>中断通信</span></a></h3><p>中断连接起了硬件、操作系统内核和用户程序：</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>󱜸 如何区分不同的硬件中断和系统调用？ i386 系统采用了中断向量表（IDT）维护中断号对应的中断处理程序地址。每一个中断号，都有其指定含义，例如 <code>0x00</code> 表示 CPU 除法除零错误。按照规定，<code>0x00-0x1F</code> 这 32 个中断用于硬件中断（CPU 和 8259A 连接的外设）；<code>0x20-0xFF</code> 留给操作系统来指定。这 256 个中断，构成了硬件和用户程序与操作系统沟通的桥梁。</p><div class="callout" data-callout="tip"><div class="callout-title"><div class="callout-title-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">BIOS 与 IDT</div></div><div class="callout-content"><p>在 BIOS 和实模式中，我们就可以使用 <code>int</code> 软中断来打印屏幕，此时的 IDT 中其实已经写入了 BIOS 中实现的基本中断处理程序。在操作系统初始化时，实际上是覆盖 IDT 表中原有的处理函数。</p></div></div><p>一般来说，系统调用被放在了 <code>0x80</code> 的位置，而具体执行何种调用，取决于写入寄存器的传参；返回值也是通过写入和读取寄存器实现的。</p><h4 id="变与不变" tabindex="-1"><a class="header-anchor" href="#变与不变"><span>变与不变</span></a></h4><p>󱜸 跳转的过程中，哪些寄存器的值会改变？该如何传参？ i386 提供了 <code>pusha</code> 和 <code>popa</code> 指令用于将通用寄存器的值压入和弹出当前栈。在内核函数接手前，CPU 已经将<code>SS</code> 和 <code>ESP</code> 进行了修改，而其他的寄存器值保持不变。因此，我们可以利用不变的寄存器来传递系统调用的参数。 值得注意的是，用户程序可没法保证传回来的寄存器值不变（因为可能有返回值的存在）。因此，比较稳健的做法是在用户程序发起系统调用前保留寄存器的值。</p><h4 id="读与写" tabindex="-1"><a class="header-anchor" href="#读与写"><span>读与写</span></a></h4><p>读写（I/O）是一个简单但完整的硬件、操作系统内核和用户程序通过中断通信的过程。三个子系统的行为如下：</p><ul><li>硬件（键盘）：当用户按下按键的时候，通过电路发送信号，8259A 获取信号后发送中断信号（在实验中，中断号为 <code>0x21</code>）</li><li>操作系统内核： <ul><li>处理 <code>0x21</code>（键盘按键中断）：根据按键，向输入缓存区 <code>keyBuffer</code> 中写入/删除字符，并将结果输出在屏幕上。</li><li>处理 <code>0x80</code>（系统调用中断） <ul><li>读取字符：从 <code>keyBuffer</code> 中取出一个字符</li><li>读取字符串：从 <code>keyBuffer</code> 中取出字符串</li><li>打印字符/字符串：向显存中写入字符/字符串</li></ul></li></ul></li><li>用户程序：发起 <code>0x80</code> 系统调用，通过写寄存器传入参数（读/写），从寄存器中获取返回值（字符）</li></ul><p>󱜸 键盘按键和读取的调用先后顺序是怎么样的？ 在操作系统视角下，键盘按键和读取是独立的，并不存在先放入 <code>keyBuffer</code> 再从中取值的先后顺序。此时，为了保证正常的读入，需要对输入进行缓存。实验中选择实现了比较常见的缓存方式：不断将键盘输入写入缓存，换行为止。</p><ul><li><code>syscallGetChar</code> 行为与 <code>getchar()</code> 相似，如果缓存区非空，直接取第一个字符；否则会等待到按下换行，然后只取缓存区中的第一个字符返回。</li><li><code>syscallGetStr</code> 行为与 <code>scanf(&quot;%s&quot;)</code> 相似，如果缓存区非空，直接取从头开始到空格或换行结束（以 <code>\0</code> 而空格或换行结尾）；否则会等待到按下换行，然后取缓存区从头开始到空格或换行结束。 实现中，可以使用 <code>hlt</code> 指令让 CPU 休眠直到下一次中断到来。</li></ul></div></div><footer class="page-meta"><!----><!----></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← Lab 1：PC，启动</span><span class="page-nav-item next">Lab 3：进程调度 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">目录</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/OS/Lab%202%EF%BC%9A%E4%BB%8E%E5%86%85%E6%A0%B8%E5%88%B0%E7%94%A8%E6%88%B7.html#lab-2-从内核到用户" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Lab 2：从内核到用户"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Lab 2：从内核到用户<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/OS/Lab%202%EF%BC%9A%E4%BB%8E%E5%86%85%E6%A0%B8%E5%88%B0%E7%94%A8%E6%88%B7.html#系统接手" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="系统接手"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->系统接手<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/OS/Lab%202%EF%BC%9A%E4%BB%8E%E5%86%85%E6%A0%B8%E5%88%B0%E7%94%A8%E6%88%B7.html#特权级跳转" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="特权级跳转"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->特权级跳转<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/OS/Lab%202%EF%BC%9A%E4%BB%8E%E5%86%85%E6%A0%B8%E5%88%B0%E7%94%A8%E6%88%B7.html#中断通信" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="中断通信"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->中断通信<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CqvpY_gu.js" defer></script>
  </body>
</html>
